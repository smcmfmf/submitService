<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„ì í•˜ê¸° - ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        /* ì ìˆ˜ ì„ íƒ ë²„íŠ¼ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ */
        .grade-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        .grade-btn {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            background-color: #f8f9fa;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .grade-btn:hover {
            background-color: var(--info-color);
            color: white;
            border-color: var(--info-color);
        }
    </style>
</head>
<body class="professor-page">

<div class="header professor-header">
    <h1><i class="fas fa-edit"></i> ê³¼ì œ ì±„ì </h1>
    <nav class="header-nav">
        <a th:href="@{/professor/assignment/{id}/submissions(id=${submission.assignment.assignmentId})}"><i class="fas fa-arrow-left"></i> ì œì¶œë¬¼ ëª©ë¡ìœ¼ë¡œ</a>
    </nav>
</div>

<div class="container form-container">
    <div class="card">
        <div class="page-header" style="text-align: center;">
            <h2 class="page-title" th:text="${submission.assignment.title}"></h2>
            <p class="page-subtitle" th:text="${submission.student.name} + ' í•™ìƒì˜ ì œì¶œë¬¼'"></p>
        </div>

        <div class="alert alert-info">
            <a th:href="${submission.fileUrl}" class="btn btn-secondary"><i class="fas fa-download"></i> ì œì¶œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ</a>
            <span style="margin-left: 15px;">íŒŒì¼ì„ í™•ì¸í•œ í›„ ì±„ì ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.</span>
        </div>

        <div th:if="${submission.isGraded}" class="alert alert-warning">
            <strong>ğŸ”’ í‰ê°€ ì™„ë£Œ</strong>
            <p>ì´ ì œì¶œë¬¼ì€ ì´ë¯¸ í‰ê°€ê°€ ì™„ë£Œë˜ì–´ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>

        <form th:action="@{/professor/submission/{id}/grade(id=${submission.submissionId})}" method="post" th:unless="${submission.isGraded}">

            <div class="form-group">
                <label class="form-label">ì ìˆ˜ ê°„í¸ ì„ íƒ</label>
                <div class="grade-buttons">
                    <button type="button" class="grade-btn" onclick="setGrade(95)">A+ (95)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(90)">A0 (90)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(85)">B+ (85)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(80)">B0 (80)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(75)">C+ (75)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(70)">C0 (70)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(65)">D+ (65)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(60)">D0 (60)</button>
                    <button type="button" class="grade-btn" onclick="setGrade(0)">F (0)</button>
                </div>
            </div>

            <div class="form-group">
                <label for="grade" class="form-label">ì ìˆ˜ ì§ì ‘ ì…ë ¥ (0-100)</label>
                <input type="number" id="grade" name="grade" min="0" max="100" step="0.1" th:value="${submission.grade}" class="form-input" required>
            </div>

            <div class="form-group">
                <label for="feedback" class="form-label">í”¼ë“œë°±</label>
                <textarea id="feedback" name="feedback" th:text="${submission.feedback}" class="form-textarea" placeholder="í•™ìƒì—ê²Œ ì „ë‹¬ë  í”¼ë“œë°±ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
            </div>

            <div class="form-actions">
                <a th:href="@{/professor/assignment/{id}/submissions(id=${submission.assignment.assignmentId})}" class="btn btn-secondary">ì·¨ì†Œ</a>
                <button type="submit" class="btn btn-warning" th:formaction="@{/professor/submission/{id}/grade(id=${submission.submissionId})}"><i class="fas fa-save"></i> ì„ì‹œ ì €ì¥</button>
                <button type="submit" class="btn btn-success" id="completeBtn" th:formaction="@{/professor/submission/{id}/complete(id=${submission.submissionId})}"><i class="fas fa-check-circle"></i> í‰ê°€ ì™„ë£Œ</button>
            </div>
        </form>
    </div>
</div>

<script>
    // ë²„íŠ¼ í´ë¦­ ì‹œ ì ìˆ˜ ì…ë ¥ì°½ì— ê°’ì„ ì±„ìš°ëŠ” í•¨ìˆ˜
    function setGrade(score) {
        document.getElementById('grade').value = score;
    }

    const completeBtn = document.getElementById('completeBtn');
    if (completeBtn) {
        completeBtn.addEventListener('click', function(event) {
            const confirmed = confirm(
                'ì •ë§ë¡œ í‰ê°€ë¥¼ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n' +
                'âš ï¸ ì£¼ì˜ì‚¬í•­:\n' +
                'â€¢ í‰ê°€ ì™„ë£Œ í›„ì—ëŠ” ì ìˆ˜ì™€ í”¼ë“œë°±ì„ ìˆ˜ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n' +
                'â€¢ í•™ìƒë„ ë” ì´ìƒ ê³¼ì œë¥¼ ì¬ì œì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n' +
                'ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
            );

            if (!confirmed) {
                event.preventDefault();
            }
        });
    }
</script>

</body>
</html>