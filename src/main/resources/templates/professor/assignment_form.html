<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒˆ ê³¼ì œ ë§Œë“¤ê¸° - ê³¼ì œ ì œì¶œ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="professor-page">

<div class="header professor-header">
    <h1><i class="fas fa-plus-circle"></i> ìƒˆ ê³¼ì œ ë§Œë“¤ê¸°</h1>
    <nav class="header-nav">
        <a th:href="@{/professor/course/{id}(id=${courseId})}"><i class="fas fa-arrow-left"></i> ê³¼ì œ ëª©ë¡ìœ¼ë¡œ</a>
    </nav>
</div>

<div class="container form-container">
    <div class="card">
        <div class="page-header" style="text-align: center;">
            <h2 class="page-title">ğŸ“ ìƒˆ ê³¼ì œ ì •ë³´ ì…ë ¥</h2>
        </div>

        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <form th:action="@{/professor/course/{courseId}/assignment/new(courseId=${courseId})}"
              th:object="${assignment}" method="post" enctype="multipart/form-data" id="assignmentForm">

            <div class="form-group">
                <label for="title" class="form-label">ê³¼ì œ ì œëª©</label>
                <input type="text" id="title" th:field="*{title}" class="form-input" placeholder="í•™ìƒë“¤ì´ ì´í•´í•˜ê¸° ì‰¬ìš´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <div class="form-group">
                <label for="description" class="form-label">ê³¼ì œ ì„¤ëª…</label>
                <textarea id="description" th:field="*{description}" class="form-textarea" placeholder="ê³¼ì œì˜ ëª©í‘œ, ìš”êµ¬ì‚¬í•­, ì œì¶œ í˜•ì‹ ë“±ì„ ìì„¸íˆ ì„¤ëª…í•´ì£¼ì„¸ìš”." required></textarea>
            </div>
            <div class="form-group">
                <label for="deadline" class="form-label">ë§ˆê°ì¼</label>
                <input type="datetime-local" id="deadline" th:field="*{deadline}" class="form-input" required>
                <div id="deadlineError" class="alert alert-danger" style="display: none; margin-top: 10px;">
                    ë§ˆê°ì¼ì€ í˜„ì¬ ì‹œê°„ ì´í›„ë¡œ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
                </div>
            </div>
            <div class="form-group">
                <label for="attachmentFile" class="form-label">ì²¨ë¶€íŒŒì¼ (ì„ íƒ)</label>
                <input type="file" id="attachmentFile" name="attachmentFile" class="form-input">
            </div>
            <div class="form-actions">
                <a th:href="@{/professor/course/{id}(id=${courseId})}" class="btn btn-secondary">ì·¨ì†Œ</a>
                <button type="submit" id="submitBtn" class="btn btn-primary">ê³¼ì œ ìƒì„±í•˜ê¸°</button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deadlineInput = document.getElementById('deadline');
        const deadlineError = document.getElementById('deadlineError');
        const submitBtn = document.getElementById('submitBtn');

        // í˜„ì¬ ì‹œê°„ì„ YYYY-MM-DDTHH:MM í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜ (íƒ€ì„ì¡´ ë¬¸ì œ í•´ê²°)
        function getLocalISOString(date) {
            const offset = date.getTimezoneOffset();
            const localDate = new Date(date.getTime() - (offset * 60 * 1000));
            return localDate.toISOString().slice(0, 16);
        }

        const now = new Date();
        const minDateTime = getLocalISOString(now);

        // 1. ë§ˆê°ì¼ ì…ë ¥ì˜ ìµœì†Œê°’ì„ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •
        deadlineInput.setAttribute('min', minDateTime);

        // 2. í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ë§ˆê°ì¼ì„ 7ì¼ í›„ë¡œ ì„¤ì • (ê°’ì´ ë¹„ì–´ìˆì„ ê²½ìš°)
        if (!deadlineInput.value) {
            const defaultDeadline = new Date();
            defaultDeadline.setDate(now.getDate() + 7);
            defaultDeadline.setHours(23, 59);
            deadlineInput.value = getLocalISOString(defaultDeadline);
        }

        // 3. ì‹¤ì‹œê°„ ë§ˆê°ì¼ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
        function validateDeadline() {
            const selectedDate = new Date(deadlineInput.value);
            const currentDate = new Date();

            if (selectedDate < currentDate) {
                deadlineError.style.display = 'block';
                submitBtn.disabled = true;
            } else {
                deadlineError.style.display = 'none';
                submitBtn.disabled = false;
            }
        }

        // input ê°’ì´ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤í–‰
        deadlineInput.addEventListener('input', validateDeadline);

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ìœ íš¨ì„± ê²€ì‚¬ ì‹¤í–‰
        validateDeadline();
    });
</script>

</body>
</html>